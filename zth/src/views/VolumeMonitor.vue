<script setup lang="ts">
import { io, Socket } from 'socket.io-client';
import { onBeforeUnmount, onMounted, ref } from 'vue';
import placeHolderLoader from '../components/utils/PlaceHolderLoader.vue';
import { Websocket } from '../Interfaces/Websocket';
import BaseTable from '../components/BaseTable.vue';

const testData = [
  {
    e: 'aggTrade',
    E: 1688288752003,
    s: 'BNBUSDT',
    a: 493574274,
    p: '244.70000000',
    q: '183.05800000',
    f: 659799176,
    l: 659799198,
    T: 1688288752001,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288600201,
    s: 'BTCUSDT',
    a: 2665713610,
    p: '30500.00000000',
    q: '2.23799000',
    f: 3161217562,
    l: 3161217601,
    T: 1688288600198,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288596170,
    s: 'SOLUSDT',
    a: 249176099,
    p: '19.11000000',
    q: '1790.97000000',
    f: 367243316,
    l: 367243327,
    T: 1688288596168,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288508624,
    s: 'ETHUSDT',
    a: 916161363,
    p: '1913.19000000',
    q: '21.83920000',
    f: 1173118525,
    l: 1173118530,
    T: 1688288508624,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288434406,
    s: 'BNBUSDT',
    a: 493573888,
    p: '244.60000000',
    q: '170.41900000',
    f: 659798675,
    l: 659798675,
    T: 1688288434403,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288420325,
    s: 'BTCUSDT',
    a: 2665712922,
    p: '30484.01000000',
    q: '1.32887000',
    f: 3161216725,
    l: 3161216740,
    T: 1688288420324,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288417849,
    s: 'BTCUSDT',
    a: 2665712910,
    p: '30484.01000000',
    q: '3.25068000',
    f: 3161216703,
    l: 3161216709,
    T: 1688288417848,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288411502,
    s: 'ETHUSDT',
    a: 916161181,
    p: '1911.88000000',
    q: '18.29320000',
    f: 1173118303,
    l: 1173118311,
    T: 1688288411500,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288396319,
    s: 'ETHUSDT',
    a: 916161080,
    p: '1912.20000000',
    q: '19.11670000',
    f: 1173118146,
    l: 1173118153,
    T: 1688288396318,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288311406,
    s: 'BTCUSDT',
    a: 2665712522,
    p: '30493.99000000',
    q: '1.14280000',
    f: 3161216168,
    l: 3161216169,
    T: 1688288311401,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288211316,
    s: 'BCHUSDT',
    a: 115502780,
    p: '290.00000000',
    q: '135.94100000',
    f: 144565958,
    l: 144565958,
    T: 1688288211315,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288211311,
    s: 'BCHUSDT',
    a: 115502778,
    p: '290.00000000',
    q: '140.97100000',
    f: 144565945,
    l: 144565956,
    T: 1688288211309,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288211311,
    s: 'BCHUSDT',
    a: 115502777,
    p: '289.90000000',
    q: '252.73900000',
    f: 144565935,
    l: 144565944,
    T: 1688288211309,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288211311,
    s: 'BCHUSDT',
    a: 115502776,
    p: '289.80000000',
    q: '162.91400000',
    f: 144565920,
    l: 144565934,
    T: 1688288211309,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288206188,
    s: 'BTCUSDT',
    a: 2665712132,
    p: '30492.00000000',
    q: '1.83352000',
    f: 3161215738,
    l: 3161215746,
    T: 1688288206187,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288197437,
    s: 'BTCUSDT',
    a: 2665712102,
    p: '30490.38000000',
    q: '1.63577000',
    f: 3161215687,
    l: 3161215706,
    T: 1688288197435,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288190077,
    s: 'ETHUSDT',
    a: 916160775,
    p: '1912.26000000',
    q: '42.60600000',
    f: 1173117744,
    l: 1173117752,
    T: 1688288190077,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288189191,
    s: 'BTCUSDT',
    a: 2665712082,
    p: '30490.86000000',
    q: '1.06416000',
    f: 3161215666,
    l: 3161215666,
    T: 1688288189189,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288189191,
    s: 'BTCUSDT',
    a: 2665712070,
    p: '30492.16000000',
    q: '1.02716000',
    f: 3161215649,
    l: 3161215649,
    T: 1688288189189,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688288084973,
    s: 'LINKUSDT',
    a: 199199032,
    p: '6.38500000',
    q: '6577.27000000',
    f: 258983670,
    l: 258983675,
    T: 1688288084973,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287983405,
    s: 'CAKEUSDT',
    a: 54776486,
    p: '1.58100000',
    q: '23308.06000000',
    f: 74391147,
    l: 74391162,
    T: 1688287983404,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287841494,
    s: 'WAVESUSDT',
    a: 64014806,
    p: '1.87700000',
    q: '20857.29000000',
    f: 89778368,
    l: 89778382,
    T: 1688287841493,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287787171,
    s: 'LTCUSDT',
    a: 211213449,
    p: '110.13000000',
    q: '313.32200000',
    f: 297142633,
    l: 297142641,
    T: 1688287787169,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287651512,
    s: 'BTCUSDT',
    a: 2665710064,
    p: '30502.02000000',
    q: '1.29344000',
    f: 3161213103,
    l: 3161213103,
    T: 1688287651512,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287626674,
    s: 'BTCUSDT',
    a: 2665709997,
    p: '30500.34000000',
    q: '1.76008000',
    f: 3161213012,
    l: 3161213021,
    T: 1688287626673,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287596806,
    s: 'BTCUSDT',
    a: 2665709814,
    p: '30503.01000000',
    q: '1.18354000',
    f: 3161212679,
    l: 3161212681,
    T: 1688287596800,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287565071,
    s: 'BTCUSDT',
    a: 2665709719,
    p: '30500.24000000',
    q: '3.00000000',
    f: 3161212556,
    l: 3161212558,
    T: 1688287565070,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287540036,
    s: 'BTCUSDT',
    a: 2665709596,
    p: '30496.33000000',
    q: '1.05304000',
    f: 3161212400,
    l: 3161212406,
    T: 1688287540033,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287540033,
    s: 'ETHUSDT',
    a: 916159543,
    p: '1912.46000000',
    q: '19.36960000',
    f: 1173116267,
    l: 1173116278,
    T: 1688287540031,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287506568,
    s: 'BTCUSDT',
    a: 2665709507,
    p: '30496.01000000',
    q: '1.23994000',
    f: 3161212298,
    l: 3161212300,
    T: 1688287506567,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287505976,
    s: 'BTCUSDT',
    a: 2665709505,
    p: '30496.01000000',
    q: '1.99800000',
    f: 3161212292,
    l: 3161212296,
    T: 1688287505975,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287505346,
    s: 'BTCUSDT',
    a: 2665709498,
    p: '30496.01000000',
    q: '1.99800000',
    f: 3161212282,
    l: 3161212285,
    T: 1688287505345,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287504747,
    s: 'BTCUSDT',
    a: 2665709492,
    p: '30496.01000000',
    q: '1.99800000',
    f: 3161212275,
    l: 3161212276,
    T: 1688287504746,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287504141,
    s: 'BTCUSDT',
    a: 2665709491,
    p: '30496.01000000',
    q: '1.99800000',
    f: 3161212267,
    l: 3161212274,
    T: 1688287504140,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287499817,
    s: 'BTCUSDT',
    a: 2665709448,
    p: '30496.94000000',
    q: '2.59897000',
    f: 3161212219,
    l: 3161212222,
    T: 1688287499815,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287499817,
    s: 'BTCUSDT',
    a: 2665709443,
    p: '30497.25000000',
    q: '1.98190000',
    f: 3161212211,
    l: 3161212212,
    T: 1688287499815,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287499817,
    s: 'BTCUSDT',
    a: 2665709442,
    p: '30497.26000000',
    q: '1.27126000',
    f: 3161212210,
    l: 3161212210,
    T: 1688287499815,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287400680,
    s: 'ETHUSDT',
    a: 916159248,
    p: '1912.99000000',
    q: '18.23830000',
    f: 1173115895,
    l: 1173115902,
    T: 1688287400679,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287393426,
    s: 'ETHUSDT',
    a: 916159217,
    p: '1913.19000000',
    q: '21.24550000',
    f: 1173115827,
    l: 1173115828,
    T: 1688287393425,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287347728,
    s: 'ETHUSDT',
    a: 916159078,
    p: '1913.91000000',
    q: '31.45460000',
    f: 1173115646,
    l: 1173115662,
    T: 1688287347727,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287230417,
    s: 'BNBUSDT',
    a: 493572640,
    p: '245.20000000',
    q: '188.41400000',
    f: 659796697,
    l: 659796721,
    T: 1688287230415,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287208042,
    s: 'BTCUSDT',
    a: 2665708525,
    p: '30493.03000000',
    q: '1.79784000',
    f: 3161210856,
    l: 3161210864,
    T: 1688287208035,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287208032,
    s: 'ETHUSDT',
    a: 916158783,
    p: '1913.51000000',
    q: '20.91450000',
    f: 1173115251,
    l: 1173115260,
    T: 1688287208031,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287206567,
    s: 'ETHUSDT',
    a: 916158760,
    p: '1914.00000000',
    q: '32.09370000',
    f: 1173115215,
    l: 1173115217,
    T: 1688287206560,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287206567,
    s: 'BTCUSDT',
    a: 2665708482,
    p: '30496.24000000',
    q: '1.37250000',
    f: 3161210756,
    l: 3161210783,
    T: 1688287206559,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287172197,
    s: 'ETHUSDT',
    a: 916158668,
    p: '1914.39000000',
    q: '18.07800000',
    f: 1173115080,
    l: 1173115092,
    T: 1688287172196,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287171726,
    s: 'BNBUSDT',
    a: 493572553,
    p: '245.40000000',
    q: '164.13800000',
    f: 659796546,
    l: 659796546,
    T: 1688287171725,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287082835,
    s: 'BNBUSDT',
    a: 493572464,
    p: '245.50000000',
    q: '165.07100000',
    f: 659796387,
    l: 659796403,
    T: 1688287082833,
    m: false,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287057711,
    s: 'LTCUSDT',
    a: 211211691,
    p: '110.51000000',
    q: '312.55200000',
    f: 297139452,
    l: 297139458,
    T: 1688287057710,
    m: true,
    M: true,
  },
  {
    e: 'aggTrade',
    E: 1688287016845,
    s: 'LTCUSDT',
    a: 211211604,
    p: '110.61000000',
    q: '286.14100000',
    f: 297139278,
    l: 297139281,
    T: 1688287016843,
    m: true,
    M: true,
  },
];
const baseApiUrl = import.meta.env.VITE_APP_WEBSOCKET;

const data = ref<[Websocket]>([]);
const test = ref();
let socket: Socket;

function connectToSocket() {
  socket = io(baseApiUrl, {
    extraHeaders: {
      'my-custom-header': 'test', // Replace with your authentication token value
    },
  });

  socket.on('connect', () => {
    console.log('Connected to WebSocket server');
  });

  socket.on('message', (responseData) => {
    const dataObject: [Websocket] = JSON.parse(responseData).reverse();
    data.value = dataObject;
    test.value = dataObject[0].s;
    console.log(' data from server:', dataObject);
  });

  // To send data to the server
}

onMounted(() => {
  connectToSocket();
});

onBeforeUnmount(() => {
  socket.disconnect();
  console.log('Disconnected from WebSocket server');
});
</script>

<template>
  <div>
    <BaseTable> </BaseTable>
  </div>
</template>

<style lang="scss" scoped>
.test {
  color: white;
}
</style>
